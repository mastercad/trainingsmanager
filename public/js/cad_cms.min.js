(function(e){e.fn.CAD_CMS=function(t,n){editable_objects=t;obj_edited={};obj_edited["edited_elements"]={};array_elemente=undefined;tagArray=new Array;controller=n;e.fn.convertEditable=function(){if(editable_objects.length>0){for(var e=0;e<editable_objects.length;++e){if("P"==editable_objects[e].nodeName||"H1"==editable_objects[e].nodeName||"H2"==editable_objects[e].nodeName||"H3"==editable_objects[e].nodeName||"H4"==editable_objects[e].nodeName||"H5"==editable_objects[e].nodeName||"H6"==editable_objects[e].nodeName||"DIV"==editable_objects[e].nodeName||"PRE"==editable_objects[e].nodeName||"SPAN"==editable_objects[e].nodeName){this.convertEditableText(editable_objects[e])}else if("IMG"==editable_objects[e].nodeName){this.convertEditableImage(editable_objects[e])}else if("A"==editable_objects[e].nodeName){this.convertEditableLink(editable_objects[e])}}}};e.fn.convertEditableText=function(t){e(t).addClass("cad-cms-editable");var n=e('<div style="position: relative;"></div>');var r=e(t).clone();if(e(r).html().length==0){e(r).css("padding","20px")}if(e(r).css("float")!="none"){e(n).addClass("cad-cms-text-float-wrapper");this.searchAndMoveAllFloatingSiblings(r,n);e(n).append('<br class="clear-fix" />');e(n).css("float",e(r).css("float"));e(n).css("display",e(r).css("display"));e(n).css("width",e(r).css("width"))}else{if(r.is("SPAN")){e(n).css("display","inline-block")}e(n).addClass("cad-cms-text-dummy-wrapper");e(n).append(r)}e(n).append('<img class="cad-cms-edit-image" src="/images/content/statisch/cms/edit.png" />');e(t).replaceWith(n);e(r).parent().unbind("hover");e(r).parent().hover(function(){e(r).addClass("cad-cms-text-hover");e(this).find(".cad-cms-edit-image").stop(true,true).fadeIn()},function(){e(r).removeClass("cad-cms-text-hover");e(this).find(".cad-cms-edit-image").stop(true,true).fadeOut()});e(r).parent().find(".cad-cms-edit-image").unbind("click");e(r).parent().find(".cad-cms-edit-image").bind("click",function(){e("#cad-cms-editor").data("data-cad-cms-target",e(r));e(r).openEditor()})};e.fn.convertEditableImage=function(t){var n=e(t).clone();var r=e('<div style="position: relative;"></div>');e(n).addClass("cad-cms-editable");if(!e(".cad-cms-bild-upload-form").length){var i=e('<form id="cad-cms-bild-upload-form" method="post" action="/'+controller+'/upload-bild"  target="upload_target" enctype="multipart/form-data">');e(i).append(e('<input type="file" class="cad-cms-image-file" name="cad-cms-image-file[]" multiple style="position: absolute; top: -500px; left: -500px;" />'));e(i).append(e('<input type="hidden" class="cad-cms-hidden" name="ajax" value="true" />'));e("body").append(i);e(".cad-cms-image-file").unbind("change");e(".cad-cms-image-file").bind("change",function(){e(this).parent().submit()})}if(!e("#upload_target").length){e("body").append(e('<iframe src="#" id="upload_target" name="upload_target" ></iframe>'))}if(e(n).attr("src").length==0){e(n).css("padding","20px")}if(e(n).css("float")!="none"){e(r).addClass("cad-cms-image-float-wrapper");this.searchAndMoveAllFloatingSiblings(n,r);e('<br class="clear-fix" />').insertAfter(e(r).find(":last"))}else{e(r).addClass("cad-cms-image-dummy-wrapper");e(r).append(n)}e(r).css("display",e(n).css("display"));e(r).css("float",e(n).css("float"));e(r).css("clear",e(n).css("clear"));e(r).css("margin-top",e(n).css("margin-top"));e(r).css("margin-right",e(n).css("margin-right"));e(r).css("margin-bottom",e(n).css("margin-bottom"));e(r).css("margin-left",e(n).css("margin-left"));e(r).css("padding-top",e(n).css("padding-top"));e(r).css("padding-right",e(n).css("padding-right"));e(r).css("padding-bottom",e(n).css("padding-bottom"));e(r).css("padding-left",e(n).css("padding-left"));if(parseFloat(e(n).css("width"))){e(r).css("width",e(n).css("width"))}if(parseFloat(e(n).css("height"))){e(r).css("height",e(n).css("height"))}if(e(n).css("width").match(/%/)){e(n).css("width","100%")}if(e(n).css("height").match(/%/)){e(n).css("height","100%")}e(t).replaceWith(r);e(n).parent().unbind("hover");e(n).parent().hover(function(){e(this).find(".cad-cms-edit-image").stop(true,true).fadeIn()},function(){e(this).find(".cad-cms-edit-image").stop(true,true).fadeOut()});e(n).unbind("click");e(n).bind("click",function(){e(".cad-cms-image-file").click()})};e.fn.convertEditableLink=function(t){e(t).addClass("cad-cms-editable");if(e(t).html().length==0){e(t).css("padding","20px")}var n="cad-cms-dummy-container";if(e(t).css("float")!="none"){n="cad-cms-float-container";var r=e('<div class="'+n+'" style="position: relative;"></div>');this.searchAndMoveAllFloatingSiblings(t,r)}else{e(t).wrap('<div class="'+n+'" style="position: relative;"></div>')}e(t).parent().append('<img class="cad-cms-edit-image" src="/images/content/statisch/cms/edit.png" style="position: absolute; top: 2px; right: 2px; display: none;" />');e(t).parent().unbind("hover");e(t).parent().hover(function(){e(t).addClass("cad-cms-text-hover");e(this).find(".cad-cms-edit-image").stop(true,true).fadeIn()},function(){e(t).removeClass("cad-cms-text-hover");e(this).find(".cad-cms-edit-image").stop(true,true).fadeOut()});e(t).parent().find(".cad-cms-edit-image").unbind("click");e(t).parent().find(".cad-cms-edit-image").bind("click",function(){e("#cad-cms-editor").data("data-cad-cms-target",e(t));e(t).openEditor()})};e.fn.searchAndMoveAllFloatingSiblings=function(t,n){var r=this.searchFirstFloatingElement(e(t));array_elemente=new Array;this.addAllFloatingElements(e(r));var i=r.parent();for(var s=0;s<array_elemente.length;++s){e(n).append(array_elemente[s])}e(i).append(n)};e.fn.addAllFloatingElements=function(t){if(typeof array_elemente=="undefined"){array_elemente=new Array}if(e(t).next().length&&e(t).next().css("float")!="none"){this.addAllFloatingElements(e(t).next())}array_elemente.unshift(t);return t};e.fn.searchFirstFloatingElement=function(t){if(e(t).prev().length&&e(t).prev().css("float")!="none"&&e(t).prev().css("clear")!="left"&&e(t).prev().css("clear")!="right"&&e(t).prev().css("clear")!="both"){return this.searchFirstFloatingElement(e(t).prev())}return e(t)};e.fn.loadEditorTemplate=function(){var t="/cms/get-editor-template";var n={ajax:true};var r=this;e.post(t,n,function(t){content_editor=t;if(e("#cad-cms-editor").length==0){e("body").append(t);e("#cad-cms-editor").draggable();r.initEditorButtons()}return this})};e.fn.initEditorButtons=function(){e(".cad-cms-leiste").find(".cad-cms-button").unbind("hover");e(".cad-cms-leiste").find(".cad-cms-button").hover(function(){e(this).addClass("cad-cms-button-hover")},function(){e(this).removeClass("cad-cms-button-hover")});e(".cad-cms-leiste").find(".cad-cms-button").unbind("mousedown");e(".cad-cms-leiste").find(".cad-cms-button").mousedown(function(){e(this).addClass("cad-cms-button-active")}).mouseup(function(){e(this).removeClass("cad-cms-button-active")});e("#cad-cms-editor").find("#cad-cms-button-close").bind("click",function(){e(this).closeEditor()});e("#cad-cms-editor").find("#cad-cms-button-save").bind("click",function(){e(this).saveEditor()});e("#cad-cms-editor").find(".cad-cms-button-ubb").each(function(){e(this).data("data-ubb-tag",e(this).attr("data-ubb-tag"))});e("#cad-cms-editor").find(".cad-cms-button-ubb").bind("click",function(){e(this).postUbb(e(this).data("data-ubb-tag"))})};e.fn.openEditor=function(){var t=null;if(e(this).data("data-cad-cms-content")!=undefined){t=Base64.decode(e(this).data("data-cad-cms-content"))}if(e(this).attr("data-cad-cms-content-orig")!=undefined){e(this).data("data-cad-cms-content-orig",e(this).attr("data-cad-cms-content-orig"));if(!t){t=Base64.decode(e(this).data("data-cad-cms-content-orig"))}}if(e(this).data("data-cad-cms-content-orig")==undefined){e(this).data("data-cad-cms-content-orig",Base64.encode(e(this).html()));t=e(this).html()}showSperre(true,true,false);e("#cad-cms-editor").find("#cad-cms-textfeld").val(t);e("#cad-cms-editor").CAD_center();e("#cad-cms-editor").stop(true,true).fadeIn(function(){e(this).find("#cad-cms-textfeld").focus()})};e.fn.closeEditor=function(){e("#cad-cms-editor").data("data-cad-cms-target",null);e("#cad-cms-editor").stop(true,true).fadeOut();e("#cad-cms-editor").find("#cad-cms-textfeld").val("");hideSperre()};e.fn.saveEditor=function(){var t=e("#cad-cms-editor").data("data-cad-cms-target");var n=null;var r=null;if(e(t).data("data-cad-cms-content-orig")!=undefined&&e(t).data("data-cad-cms-content-orig").length>0){n=Base64.decode(e(t).data("data-cad-cms-content-orig"))}if(e("#cad-cms-editor").find("#cad-cms-textfeld").val().length>0){r=e("#cad-cms-editor").find("#cad-cms-textfeld").val()}if(r!=n){var i=e(t).attr("id");if(i!=undefined&&i.length>0){if(r.length>0){e(t).data("data-cad-cms-content",Base64.encode(r));obj_edited["edited_elements"][i]=Base64.encode(r);b_init_syntaxhighlight=false;if(e(t).hasClass("code")){b_init_syntaxhighlight=true}e(t).setUbbReplacedContent(r,b_init_syntaxhighlight)}}else{e(t).html(r);console.log("Editiertes Element enth√§lt keine ID! Breche ab");return false}}};e.fn.saveAll=function(){for(var t=0;t<editable_objects.length;++t){if(e(editable_objects[t]).data("data-cad-cms-content-orig")!=undefined&&e(editable_objects[t]).data("data-cad-cms-content")!=undefined&&e(editable_objects[t]).data("data-cad-cms-content-orig")!=e(editable_objects[t]).data("data-cad-cms-content")){obj_edited["edited_elements"][e(editable_objects[t]).attr("id")]=e(editable_objects[t]).data("data-cad-cms-content")}}};e.fn.reset=function(){obj_edited={};obj_edited["edited_elements"]={};return true};e.fn.getEditedElements=function(){return obj_edited};e.fn.postUbb=function(e,t){if(e==undefined){return false}var n=tagArray.length;switch(e.toUpperCase()){case"TAB+":{insert("TAB+");break};case"TAB-":{insert("TAB-");break};case"URL":{var r=prompt("Bitte geben Sie den Url ein !");if(r){r=trim(r);if(r.search(/^http:\/\/.+/i)==-1){r="http://"+r}this.insertUbb("[URL]"+r,"[/URL]")}break};case"URL=":{var r=prompt("Bitte geben Sie den Url ein !");var i=prompt("Bitte geben Sie den Namen fuer den Url ein, der erscheinen soll !");if(r&&i){r=trim(r);if(r.search(/^http:\/\/.+/i)==-1){r="http://"+r}this.insertUbb("[URL="+i+"]"+r,"[/URL]")}break};case"EMAIL":{var r=prompt("Bitte geben Sie die Email Adresse ein !");if(r){this.insertUbb("[EMAIL]"+r,"[/EMAIL]")}break};case"EMAIL=":{var r=prompt("Bitte geben Sie die Email Adresse ein !");var i=prompt("Bitte geben Sie den Namen der Email Adresse ein, der erscheinen soll !");if(r&&i){this.insertUbb("[EMAIL="+i+"]"+r,"[/EMAIL]")}break};case"COLOR":{tagArray[n]="[/COLOR]";this.insertUbb("[COLOR="+t+"]","[/COLOR]");break};case"SIZE":{tagArray[n]="[/SIZE]";this.insertUbb("[SIZE="+t+"]","[/SIZE]");break};case"IMG":{var s=prompt("Bitte geben Sie den Pfad zum Bild an!");if(s){this.insertUbb("[IMG]"+s,"[/IMG]")}break};case"UL":{tagArray[n]="[/ULISTE]";this.insertUbb("[ULISTE]","[/ULISTE]");break};case"OL":{tagArray[n]="[/OLISTE]";this.insertUbb("[OLISTE]","[/OLISTE]");break};case"LINIE":{this.insertUbb("[LINIE]");break};case"I":{tagArray[n]="[/I]";this.insertUbb("[I]","[/I]");break};case"B":{tagArray[n]="[/B]";this.insertUbb("[B]","[/B]");break};case"U":{tagArray[n]="[/U]";this.insertUbb("[U]","[/U]");break};case"BLOCK":{tagArray[n]="[/BLOCK]";this.insertUbb("[BLOCK]","[/BLOCK]");break};case"CENTER":{tagArray[n]="[/CENTER]";this.insertUbb("[CENTER]","[/CENTER]");break};case"RIGHT":{tagArray[n]="[/RIGHT]";this.insertUbb("[RIGHT]","[/RIGHT]");break};case"LEFT":{tagArray[n]="[/LEFT]";this.insertUbb("[LEFT]","[/LEFT]");break}}};e.fn.insertUbb=function(t,n){var r=e("#cad-cms-editor").find("#cad-cms-textfeld");r.focus();var i=r.val().length;var s=r[0].selectionStart;var o=r[0].selectionEnd;var u=r.val().substring(s,o);var a=t+u+n;r.val(r.val().substring(0,s)+a+r.val().substring(o,i))};e.fn.setUbbReplacedContent=function(t,n){var r="/cms/get-ubb-replaced-content/";var i=e(".language").html();if(i!=undefined&&i.length>0){i=i.toLowerCase()}var s={content:Base64.encode(t),language:Base64.encode(i),ajax:true};var o=e(this);if(t.length){e.post(r,s,function(t){obj_content=JSON.parse(t);t=obj_content.str_replaced_content;if(n){beispiel_content=Base64.decode(obj_content.str_beispiel_content)}o.html(Base64.decode(t));if(true===n){e(".beispiel-code").html(beispiel_content);e(".code").removeClass(function(e,t){return(t.match(/\language-\S+/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/\lang-\S+/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/highlight/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/linenums/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/prettyprint/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/theme\-balupton/g)||[]).join(" ")});e(".code").removeClass(function(e,t){return(t.match(/prettyprint\-has/g)||[]).join(" ")});e(".code").addClass("language-"+i);e.SyntaxHighlighter.init()}})}};e.fn.setController=function(e){controller=e};this.loadEditorTemplate();this.convertEditable()}})(jQuery)